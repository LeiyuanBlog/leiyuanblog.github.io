---
layout:     post
title:      ç»ˆç«¯ç®¡ç†K8så‘½ä»¤å¤ªå¤šå¤ªè´¹åŠ²ï¼Ÿè¯•è¯•å®˜æ–¹çš„Dashboardï¼Œä½ 100%å–œæ¬¢
subtitle:   ç»ˆç«¯ç®¡ç†K8så‘½ä»¤å¤ªå¤šå¤ªè´¹åŠ²ï¼Ÿè¯•è¯•å®˜æ–¹çš„Dashboardï¼Œä½ 100%å–œæ¬¢
date:       2020-09-04
author:     LY
header-img: img/post-bg-debug.png
catalog: true
tags:
    - K8S



---

> æ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘çš„ä»¥ä¸‹ä¸»é¡µï¼Œå°¤å…¶æ˜¯ä»Šæ—¥å¤´æ¡ï¼ï¼ï¼è°¢è°¢ğŸ™ğŸ™ğŸ™
>
> csdnï¼š[é›·å›­çš„csdnåšå®¢](https://blog.csdn.net/leiyuan2580)
>
> ä¸ªäººåšå®¢ï¼š[é›·å›­çš„ä¸ªäººåšå®¢](https://imlcl.store)
>
> ç®€ä¹¦ï¼š[é›·å›­çš„ç®€ä¹¦](https://www.jianshu.com/u/016322e40e1f)
>
> ä»Šæ—¥å¤´æ¡ï¼š[æ¥è‡ªåº•å±‚ç¨‹åºå‘˜çš„ä»°æœ›](https://www.toutiao.com/c/user/6132192948/#mid=1616456407686158)

## ç»ˆç«¯ç®¡ç†K8så‘½ä»¤å¤ªå¤šå¤ªè´¹åŠ²ï¼Ÿè¯•è¯•å®˜æ–¹çš„Dashboardï¼Œä½ 100%å–œæ¬¢

#### å¼€å¤´è¯´å‡ å¥

1. ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬è¯´äº†å®˜æ–¹æä¾›çš„æœ€ç®€ä¾¿çš„å®‰è£…æ–¹å¼**Kubeadm**ï¼Œç›¸ä¿¡å°ä¼™ä¼´ä»¬ä¹Ÿåˆ©ç”¨è¿™ä¸€æ–¹å¼æ­å»ºèµ·äº†è‡ªå·±çš„ç¬¬ä¸€ä¸ªK8sé›†ç¾¤ã€‚
2. ä»Šå¤©æˆ‘ä»¬æ¥è¯´ä¸€è¯´å¦‚ä½•æ­å»ºå®˜æ–¹çš„**Dashboard**æ¥ç®¡ç†æˆ‘ä»¬çš„K8sé›†ç¾¤ã€‚
3. é‚£åé¢æˆ‘ä»¬è¿˜ä¼šæœ‰å¾ˆå¤šå…³äºK8sä½¿ç”¨æ–¹é¢çš„å°çŸ¥è¯†å°æŠ€å·§ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å…³æ³¨æˆ‘ï¼Œæ–‡ç« æœ«å°¾æˆ‘ä¼šåˆ—å‡ºæˆ‘ä»¬å°†è¦è°ˆåˆ°çš„è¯é¢˜å“¦ï¼Œè®°å¾—çœ‹å®Œï¼
4. å…ˆæ¥ä¸ªä¸Šç¯‡æ–‡ç« çš„é“¾æ¥å§ï¼ï¼ï¼æœ‰äº›è½¯ä»¶åŒ…åœ¨ä¸Šç¯‡æ–‡ç« ä¸­æœ‰è¯´åˆ°

#### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Kubernetes Dashboardï¼Ÿ

1. çœ‹åˆ°è¿™é‡Œæœ‰å°ä¼™ä¼´å°±è¦é—®äº†ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨**Dashboard**ï¼Ÿå“ˆå“ˆå“ˆï¼Œæ— ä»–ï¼Œå”¯å¥½ç”¨å°”ï¼
2. linuxå®åœ¨æ˜¯æœ‰å¤ªå¤šå¤ªå¤šçš„å‘½ä»¤äº†ï¼Œå°ç¼–çš„è„‘å­æ ¹æœ¬è®°ä¸ä½ï¼Œæ¯æ¬¡éƒ½è¦æŸ¥å¤ªè´¹åŠ²äº†ï¼Œæœ‰å®˜æ–¹æä¾›çš„ç®¡ç†å¹³å°å½“ç„¶è¦å¿«å¿«ç”¨èµ·æ¥äº†ã€‚

#### Kubernetes Dashboard å¯ä»¥åšä»€ä¹ˆ

åŸºæœ¬ä¸Šä¸€ç›®äº†ç„¶äº†å§ï¼Œé‚£æˆ‘å°±ä¸è¯´äº†ï¼Œè¯´èµ·æ¥æŒºè´¹åŠ²çš„ï¼

#### æ­£å¼å¼€å§‹

##### Kubernetes Dashboard å®‰è£…

1. é¦–å…ˆå‘¢æˆ‘ä»¬å…ˆè·å–ä¸€ä¸‹å®˜æ–¹æä¾›çš„**recommended.yaml**é…ç½®æ–‡ä»¶ï¼Œä¸è¿‡å’±è¿™ç½‘ç»œä¸€èˆ¬æ˜¯ä¸‹è½½ä¸ä¸‹æ¥ï¼Œå›å¤æˆ‘å…³é”®å­—**k8s**ä¼šæä¾›ç›¸å…³æ‰€æœ‰çš„è½¯ä»¶åŒ…ç»™å¤§å®¶å“¦ï¼ï¼

2. æˆ‘ä»¬å…ˆæ‰“å¼€**recommended.yaml**ï¼Œæ‰¾åˆ°ä¸‹é¢è¿™ä¸€æ®µï¼ˆçº¢è‰²æ¡†å†…ï¼‰

3. æˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸€æ®µå†…å‘¢æ·»åŠ ä¸¤å¯¹é”®å€¼ï¼Œä¿®æ”¹åè¿™æ®µåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

   ```yaml
   kind: Service
   apiVersion: v1
   metadata:
     labels:
       k8s-app: kubernetes-dashboard
     name: kubernetes-dashboard
     namespace: kubernetes-dashboard
   spec:
     type: NodePort
     ports:
       - port: 443
         targetPort: 8443
         nodePort: 30443
     selector:
       k8s-app: kubernetes-dashboard
   ```

4. æˆ‘ç®€å•çš„è§£é‡Šä¸€ä¸‹ï¼Œæˆ‘ä»¬è¿™é‡Œæ·»åŠ äº†**type: NodePort**ï¼Œè¿™ä¸ªå‘¢æ„æ€æ˜¯**service**å¯¹å¤–å¼€æ”¾ç«¯å£ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡**nodeã€master**èŠ‚ç‚¹çš„IPæ¥è®¿é—®è¯¥æœåŠ¡ã€‚é‚£åé¢**nodePort: 30443**å¤§å®¶åº”è¯¥ä¹Ÿå°±æ˜ç™½äº†æ˜¯å¯¹å¤–å¼€æ”¾çš„ç«¯å£å·ã€‚

5. ä¿®æ”¹å¥½ä¹‹åæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å®‰è£…äº†ï¼Œä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬åŒæ ·ä¸ºå¤§å®¶æä¾›çš„**Kubernetes Dashboard**ç›¸å…³çš„é•œåƒï¼Œä¸ç„¶æˆ‘ä»¬è¿™è¾¹è¿˜ä¸å¤ªå¥½ä¸‹è½½ã€‚

   ```shell
   $ kubectl create -f recommended.yaml
   ```

6. å‘½ä»¤æ‰§è¡Œå®Œæ¯•åæˆ‘ä»¬å°±å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹å¯¹åº”çš„**serviceã€pod**çš„çŠ¶æ€äº†

   ```shell
   $ kubectl get pod,svc -n kubernetes-dashboard
   ```

##### åˆ›å»º Kubernetes Dashboard è¶…çº§ç®¡ç†ç”¨æˆ·

1. é»˜è®¤Dashboardä¸ºæœ€å°RBACæƒé™ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ é›†ç¾¤ç®¡ç†å‘˜çš„æƒé™ä»¥æ–¹ä¾¿æˆ‘ä»¬ä»**Dashboard**é¡µé¢æ“ä½œé›†ç¾¤èµ„æºã€‚

2. é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»º**adminuser.yaml**

   ```yaml
   apiVersion: v1
   kind: ServiceAccount
   metadata:
     name: admin-user
     namespace: kubernetes-dashboard
   ---
   apiVersion: rbac.authorization.k8s.io/v1
   kind: ClusterRoleBinding
   metadata:
     name: admin-user
   roleRef:
     apiGroup: rbac.authorization.k8s.io
     kind: ClusterRole
     name: cluster-admin
   subjects:
   - kind: ServiceAccount
     name: admin-user
     namespace: kubernetes-dashboard
   ```

3. ç„¶åå°±æ˜¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åœ¨é›†ç¾¤ä¸­åˆ›å»ºç”¨æˆ·ï¼š

   ```shell
   $ kubectl create -f adminuser.yaml
   ```

4. ç„¶åæˆ‘ä»¬å°±å¯ä»¥è®¿é—®äº†é¡µé¢äº†ï¼Œè®¿é—®åœ°å€æ˜¯ï¼šhttps://{YourNodeIp}:30443

5. ä½ ä¼šå‘ç°ä»–ä¼šæç¤ºæˆ‘ä»¬è¯ä¹¦ä¸å¯¹ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸Šé¢çš„**recommended.yaml**ä¸­ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç©ºçš„è¯ä¹¦ã€‚æœ‰çš„æµè§ˆå™¨ç”šè‡³æ— æ³•å¼ºè¡Œè·³è½¬ï¼Œè¿™å°±æ¶‰åŠåˆ°æˆ‘ä»¬ä¸‹é¢çš„è¯ä¹¦é…ç½®äº†ï¼

6. é¡µé¢éœ€è¦æˆ‘ä»¬æä¾›ä¸€ä¸ª**token**è¿›è¡Œç™»å½•ï¼Œæœ€é•¿çš„é‚£ä¸€æ®µå°±æ˜¯ï¼š

      ```shell
   $ kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '{print $1}')
   ```

##### ä¸º Kubernetes Dashboard é…ç½®æ­£ç¡®çš„åŸŸåè¯ä¹¦

1. è¿™é‡Œæˆ‘ä»¬è¦é…ç½®çš„æ˜¯æ­£ç¡®çš„åŸŸåè¯ä¹¦å“¦ï¼Œå°±åƒæˆ‘çš„æˆªå›¾ä¸€æ ·ã€‚é‚£æ²¡æœ‰åŸŸåçš„å°ä¼™ä¼´å¯ä»¥ä½¿ç”¨è‡ªç­¾åè¯ä¹¦å“¦ï¼Œæˆ–è€…ä½¿ç”¨**hosts**é…ç½®ä¹Ÿå¯ä»¥ï¼

2. é¦–å…ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡å¥½æˆ‘ä»¬çš„è¯ä¹¦ä»¥åŠkeyæ–‡ä»¶ï¼Œè¿™é‡Œè¦æ³¨æ„äº†ï¼Œæˆ‘ä»¬çš„è¯ä¹¦å‘½åä¸€å®šæ˜¯**dashboard.crt**ï¼Œæˆ‘ä»¬çš„keyå‘½åä¸€å®šæ˜¯**dashboard.key**ã€‚é€šè¿‡æˆ‘çš„å®è·µè¿™æ˜¯çœŸç†ï¼Œå…·ä½“ä¸ºä»€ä¹ˆå’±ä¹Ÿä¸çŸ¥é“ï¼Œå’±ä¹Ÿä¸æ•¢é—®ï¼ˆå¯èƒ½å®˜æ–¹æ–‡æ¡£é‡Œæœ‰å†™å’±æ²¡çœ‹è§ï¼‰ã€‚

3. æ¥ä¸‹æ¥æˆ‘ä»¬è¦æŸ¥çœ‹ä¸€ä¸‹å½“å‰æ˜¯å¦å­˜åœ¨è¯ä¹¦ï¼ˆè¿™é‡Œç®—æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼‰

   ```shell
   $ kubectl get secret -n kubernetes-dashboard|grep kubernetes-dashboard-certs
   ```

4. é‚£æˆ‘ä»¬éœ€è¦å…ˆåˆ é™¤è¿™ä¸ªè¯ä¹¦é…ç½®ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½æ·»åŠ è‡ªå·±çš„è¯ä¹¦

   ```shell
   $ kubectl delete secret kubernetes-dashboard-certs -n kubernetes-dashboard
   ```

5. åˆ é™¤ä¹‹åå‘¢æˆ‘ä»¬ï¼Œæˆ‘ä»¬å°±è¦åˆ›å»ºè‡ªå·±çš„è¯ä¹¦äº†ï¼Œåƒä¸‡æ³¨æ„æ­¥éª¤2ä¸­çš„å‘½åé—®é¢˜ï¼ï¼ï¼è¿™æ˜¯ä¸ªå·¨å‘

   ```shell
   $ kubectl create secret generic kubernetes-dashboard-certs --from-file="dashboard.crt" --from-file="dashboard.key" -n kubernetes-dashboard
   ```

6. è¯ä¹¦åˆ›å»ºå¥½äº†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é‡å¯podæ‰èƒ½ç”Ÿæ•ˆï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥åˆ é™¤podï¼Œdeploymentç›‘æµ‹åˆ°podè¢«åˆ é™¤åä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„

   ```shell
   # å…ˆæŸ¥çœ‹kubernetes-dashboardçš„podåç§°
   $ kubectl get pod -n kubernetes-dashboard
   # åˆ é™¤è¯¥pod
   $ kubectl delete pod kubernetes-dashboard-7f99b75bf4-sbmdp -n kubernetes-dashboard
   ```

##### ç»“æŸäº†ï¼ï¼ï¼

1. è‡³æ­¤æˆ‘ä»¬çš„è¯ä¹¦ä¹Ÿæå®šäº†ï¼Œä¸è¿‡éœ€è¦é‡æ–°è·å–ä¸€ä¸‹tokenï¼Œæ¸…ç†ä¸€ä¸‹é¡µé¢ç¼“å­˜ã€‚
2. è¿™æ ·å°±å¯ä»¥æ­£å¸¸çš„ä½¿ç”¨å’Œç™»å½•äº†ã€‚

#### æœ€åè¯´ä¸¤å¥

1. è¿™ç« èŠ‚å°±åˆ°è¿™é‡Œå•¦ï¼Œå¸Œæœ›å¤§å®¶æœ‰æ‰€æ”¶è·ã€‚
2. åé¢æˆ‘ä»¬è¿˜æœ‰ä¸€äº›å…³äºK8såº”ç”¨æ–¹é¢çš„å°çŸ¥è¯†ã€å°æŠ€å·§ï¼š
   1. K8s ç®€å•åº”ç”¨ï¼ˆpodï¼Œdeploymentï¼‰
   2. åº”ç”¨äº’ç›¸è®¿é—®ã€å¯¹å¤–å¼€æ”¾è®¿é—®ï¼ˆserviceï¼ŒnodePortï¼‰
   3. ï¼ˆnfsï¼‰ç£ç›˜æŒ‚è½½
   4. é…ç½®æ–‡ä»¶ï¼ˆconfig-mapï¼‰
   5. ä½¿ç”¨K8sæ­å»ºè‡ªå·±çš„dockeré•œåƒä»“åº“å¹¶ä¸”é…å¤‡web-ui
3. æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å…³æ³¨æˆ‘å“¦ï¼ï¼ï¼
4. è°¢è°¢å¤§å®¶ï¼ï¼ï¼


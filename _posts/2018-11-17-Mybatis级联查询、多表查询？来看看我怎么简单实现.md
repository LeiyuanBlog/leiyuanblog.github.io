---
layout:     post
title:      Mybatisçº§è”æŸ¥è¯¢ã€å¤šè¡¨æŸ¥è¯¢ï¼Ÿæ¥çœ‹çœ‹æˆ‘æ€ä¹ˆç®€å•å®ç°
subtitle:   Mybatisçº§è”æŸ¥è¯¢ã€å¤šè¡¨æŸ¥è¯¢
date:       2018-11-17
author:     LY
header-img: img/post-bg-debug.png
catalog: true
tags:
    - java
    - spring
    - springboot
    - mybatis
---

> æ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘çš„ä»¥ä¸‹ä¸»é¡µï¼Œå°¤å…¶æ˜¯ä»Šæ—¥å¤´æ¡ï¼ï¼ï¼è°¢è°¢ğŸ™ğŸ™ğŸ™
>
> csdnï¼š[é›·å›­çš„csdnåšå®¢](https://blog.csdn.net/leiyuan2580)
>
> ä¸ªäººåšå®¢ï¼š[é›·å›­çš„ä¸ªäººåšå®¢](https://imlcl.store)
>
> ç®€ä¹¦ï¼š[é›·å›­çš„ç®€ä¹¦](https://www.jianshu.com/u/016322e40e1f)
>
> ä»Šæ—¥å¤´æ¡ï¼š[æ¥è‡ªåº•å±‚ç¨‹åºå‘˜çš„ä»°æœ›](https://www.toutiao.com/c/user/6132192948/#mid=1616456407686158)

### å‰è¨€

1.åœ¨è¿™é‡Œè¯´å‡ å¥åºŸè¯å“ˆã€‚ã€‚ã€‚

2.ä¾æ—§æ„Ÿè°¢å„ä½çš„é˜…è¯»å’Œå…³æ³¨ã€‚åˆšåŠ å…¥ä¸ä¹…ï¼Œéå¸¸æ„Ÿè°¢èƒ½æ”¯æŒæˆ‘ã€å…³æ³¨æˆ‘çš„æœ‹å‹ä»¬ã€‚ä¸€å®šä¸è®©å¤§å®¶å¤±æœ›ï¼Œä¸€å®šä¼šæŒç»­ä¸æ–­çš„æ›´æ–°æ›´å¤šçš„ç›¸å…³æ–‡ç« ã€‚

3.å¸Œæœ›å¤§å®¶ä¸€å¦‚æ—¢å¾€å…³æ³¨ã€æ”¯æŒæˆ‘ï¼ï¼ï¼

### æ­¥å…¥æ­£é¢˜

1.ä¸çŸ¥é“å¤§å®¶æ­¥å…¥ç¼–ç¨‹è¡Œä¸šå¤šä¹…äº†ï¼Œä¸è¿‡æˆ‘ç›¸ä¿¡æ—¢ç„¶å¤§å®¶æœ‰å…´è¶£ç‚¹è¿›æ¥ï¼Œå¯¹äºå•è¡¨çš„æ“ä½œè‚¯å®šæ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å°±ä¸å¯¹å•è¡¨çš„æ“ä½œåšè¿‡å¤šçš„èµ˜è¿°ã€‚

2.ç›¸ä¿¡å¤§å®¶æ— åœ¨ç¼–ç ã€å†™é¡¹ç›®çš„æ—¶å€™ï¼Œä¸€å®šä¸ä¼šæ˜¯çŸ¥è¯†ç®€å•çš„å•è¡¨æ“ä½œã€‚ä¸€å®šä¼šå­˜åœ¨å¤šè¡¨å…³è”çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»Šå¤©å°±æ¥ç®€å•çš„è¯´ä¸€ä¸‹mybatisçš„çº§è”æŸ¥è¯¢ã€‚ä¸å¾—ä¸è¯´mybatisç¡®å®æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨æˆ‘ä¹‹å‰è¯´è¿‡çš„mybatis-plusï¼Œè¯¦æƒ…å¯ä»¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼Œ[Mybatis-Plusæ¥å­¦ä¹ ä¸€ä¸‹ï¼](https://imlcl.store/2018/11/14/Mybatis-Plus%E6%9D%A5%E5%AD%A6%E4%B9%A0%E4%B8%80%E4%B8%8B-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6/)å½“ç„¶å¤§å®¶æœ‰ä»€ä¹ˆçœ‹ä¸æ‡‚çš„åœ°æ–¹å¯ä»¥ç§ä¿¡æˆ–è€…è¯„è®ºå‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šä¸€ä¸€è§£ç­”ã€‚

#### ç¼–ç 

1.å‡å¦‚æˆ‘ä»¬ç°åœ¨æœ‰è§’è‰²(Roles)ã€æƒé™(Permission)ã€ç”¨æˆ·(User)ä¸‰å¼ è¡¨ï¼Œä¸‰è€…å®ä½“ç±»å¦‚ä¸‹ï¼Œå› ä¸ºæˆ‘åŠ å…¥äº†lombokï¼Œæ‰€ä»¥çœç•¥æ‰äº†æ‰€æœ‰çš„å°è£…æ–¹æ³•ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥åœ¨æ–‡ç« ä¸‹æ–¹æŸ¥çœ‹æ›´å¤šï¼š

```java
// Userç”¨æˆ·
import lombok.Data;
/**
 * @author æ¥è‡ªåº•å±‚ç¨‹åºå‘˜çš„ä»°æœ›
 * @since 2018-11-16
 */
@Data
public class User implements Serializable {
    private static final long serialVersionUID = 1L;
    private String id;
    private String username;
    private String num;
    private String password;
    private String phone;
    private String sex;
    private Integer star;
}

// Rolesè§’è‰²
import lombok.Data;
/**
 * @author æ¥è‡ªåº•å±‚ç¨‹åºå‘˜çš„ä»°æœ›
 * @since 2018-11-16
 */
@Data
public class Roles  implements Serializable{
    private static final long serialVersionUID = 1L;
    private String id;
    private String roles;
    private String username;
}

// Permissionæƒé™
import lombok.Data;
/**
 * @author æ¥è‡ªåº•å±‚ç¨‹åºå‘˜çš„ä»°æœ›
 * @since 2018-11-16
 */
@Data
public class Permissions implements Serializable {
    private static final long serialVersionUID = 1L;
    private String id;
    private String permissions;
    private String roles;
}

```

2.å¦‚æœæˆ‘ä»¬æ˜¯ç½‘ç«™çš„ç®¡ç†å‘˜ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹æ‰€æœ‰çš„è§’è‰²ä»¥åŠå®ƒå¯¹åº”çš„æƒé™ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Œç›¸ä¿¡sqlè¯­å¥å¤§å®¶éƒ½ä¼šå†™ï¼š

```xml
    <select id="getRolesPermissionsList" resultType="RolesPermissions">
        select
            r.id as rolesId,
            r.roles as rolesName,
            r.studentNum as userName,
            p.id as permissionsId,
            p.permissions as permissions
        from roles r,permissions p
        where r.roles=p.roles;
    </select>
```

å‘ï¼Œè¿™æ˜¯æœ€ç®€å•çš„ä¸¤è¡¨è”æŸ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå¯¹æŸ¥è¯¢åˆ°çš„æ•°æ®è¿›è¡Œå°è£…å‘¢ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬éœ€è¦å°è£…è¿™æ ·çš„ä¸€ä¸ªvoç±»**RolesPermissions.java**,å¹¶ä¸”ä¸ºå…¶å°è£…ä¸ªä¸€ä¸ªå¯¹åº”çš„æ„é€ æ–¹æ³•ï¼š

```java
import lombok.Data;
@Data
public class RolesPermissions {
    private String rolesId;
    private String permissionId;
    private String roles;
    private String username;
    private String permissions;
    public RolesPermissions(String rolesId, String permissionId, String roles, String username, String permissions) {
        this.rolesId = rolesId;
        this.permissionId = permissionId;
        this.roles = roles;
        this.username = username;
        this.permissions = permissions;
    }
}
```

æ˜¯ä¸æ˜¯æ˜¾å¾—ç‰¹åˆ«è‡ƒè‚¿è€Œä¸”æˆ‘ä»¬å·²ç»æœ‰äº†Roleså’ŒPermissionä¸ºä»€ä¹ˆä¸ç›´æ¥æ‹¿æ¥ç”¨å‘¢ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºæ›´å¥½çš„æ–¹å¼æ˜¯è¿™æ ·çš„ï¼š

```xml
    <!-- Mapper.xml -->
	<resultMap id="rolesPermissions" type="com.leiyuan.vo.RolesPermissions">
        <association property="roles" javaType="com.leiyuan.entity.Roles">
            <id property="id" column="rolesId"/>
            <result property="roles" column="rolesName"/>
            <result property="studentNum" column="userName"/>
        </association>
        <association property="permissions" javaType="com.leiyuan.entity.Permissions">
            <id property="id" column="permissionsId"/>
            <result property="roles" column="rolesName"/>
            <result property="permissions" column="permissions"/>
        </association>
    </resultMap>
    <select id="getRolesPermissionsList" resultMap="rolesPermissions">
        select
            r.id as rolesId,
            r.roles as rolesName,
            r.studentNum as userName,
            p.id as permissionsId,
            p.permissions as permissions
        from roles r,permissions p
        where r.roles=p.roles;
    </select>
```

```java
import lombok.Data;
// vo
@Data
public class RolesPermissions {
    private Roles roles;
    private Permissions permissions;
}
```

è¿™æ ·çš„è¯æ˜¯ä¸æ˜¯æ¸…æ¥šäº†è®¸å¤šï¼Œåœ¨xmlä¸­çš„å¯¹åº”å…³ç³»æ›´åŠ æ˜ç¡®æ˜“æ‡‚ï¼Œæ–¹ä¾¿æŸ¥çœ‹å’Œä¿®æ”¹ï¼ï¼ï¼

3.ä»¥ä¸Šæ˜¯ç®€å•çš„ä¸¤è¡¨è”æŸ¥ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»åº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼ŸUserå’ŒRoles çš„å…³ç³»å°±æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå› ä¸ºä¸€ä¸ªç”¨æˆ·å¯èƒ½ä¸ä»…ä»…æ‹¥æœ‰ä¸€ä¸ªè§’è‰²ï¼Œä»–å¯èƒ½å³æ˜¯ç‰ˆä¸»åˆæ˜¯å§ä¸»ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªvoç±»ä¸­ä¼šåŒ…å«æœ‰ä¸€ä¸ªå®ä½“ç±»ä»¥åŠä¸€ä¸ªåˆ—è¡¨ï¼Œé‚£æˆ‘ä»¬æ¥ç€å¾€ä¸‹æ¥ï¼

4.æˆ‘ä»¬å…ˆæ¥å°è£…ä¸€ä¸ªvoç±»

```java
import lombok.Data;
import java.util.List;
@Data
public class UserRoles {
    private User user; // ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯
    private List<Roles> rolesList; // ç”¨æˆ·çš„è§’è‰²åˆ—è¡¨
}
```

5.å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„voç±»åŒ…å«æœ‰ä¸€ä¸ªå®ä½“ç±»Userä»¥åŠä¸€ä¸ªé›†åˆrolesListï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†™mapper.xml

```xml
    <resultMap id="userRoles" type="com.leiyuan.vo.UserRoles">
        <association property="user" javaType="com.leiyuan.entity.User">
            <id property="id" column="userId"/>
            <result property="username" column="username"/>
            <result property="num" column="userNum"/>
            <result property="password" column="userPassword"/>
            <result property="phone" column="userPhone"/>
            <result property="sex" column="userSex"/>
            <result property="star" column="userStar"/>
        </association>
        <!-- è§’è‰²åˆ—è¡¨ -->
        <collection property="rolesList" ofType="com.leiyuan.entity.Roles">
            <id property="id" column="rolesId"/>
            <result property="roles" column="roles"/>
            <result property="username" column="username"/>
        </collection>
    </resultMap>
    <select id="getUserRolesList" resultMap="userRoles">
        select
            u.id as userId,
            u.username as username,
            u.num as userNum,
            u.password as userPassword,
            u.phone as userPhone,
            u.sex as userSex,
            u.star as userStar,
            r.id as rolesId,
            r.roles as roles 
        from user u
            left outer join roles r on u.username=r.username
            where u.id=#{userId}
    </select>
		<!-- ä¸Šé¢çš„ userIdæ˜¯æˆ‘ä¼ è¿‡æ¥çš„ç”¨æˆ·id-->
```

### ç»“æŸè¯­

1.é¦–å…ˆæˆ‘ä»¬éœ€è¦ææ¸…æ¥šmybatisçš„æ˜ å°„å…³ç³»è€Œä¸”å¿…é¡»å­¦ä¼šsqlçš„å†…è¿æ¥ã€å·¦è¿æ¥ã€å³è¿æ¥ï¼Œæ‰èƒ½å®ç°æˆ‘ä»¬éœ€è¦çš„å¤šè¡¨æŸ¥è¯¢ã€‚

2.å¹²è´§ä¸æ–­ï¼Œå¸Œæœ›å¤§å®¶å¤šå¤šæ”¯æŒï¼Œç§ä¿¡æˆ–è€…è¯„è®ºæˆ‘ï¼Œè¯´è¯´è‡ªå·±æƒ³è¦äº†è§£çš„å†…å®¹ï¼ï¼ï¼
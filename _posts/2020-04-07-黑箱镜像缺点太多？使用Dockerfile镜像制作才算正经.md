---
layout:     post
title:      é»‘ç®±é•œåƒç¼ºç‚¹å¤ªå¤šï¼Ÿä½¿ç”¨Dockerfileé•œåƒåˆ¶ä½œæ‰ç®—æ­£ç»
subtitle:   é»‘ç®±é•œåƒç¼ºç‚¹å¤ªå¤šï¼Ÿä½¿ç”¨Dockerfileé•œåƒåˆ¶ä½œæ‰ç®—æ­£ç»
date:       2020-04-07
author:     LY
header-img: img/post-docker-bk.png
catalog: true
tags:
    - docker
	- ä¸“æ 

---

> æ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘çš„ä»¥ä¸‹ä¸»é¡µï¼Œå°¤å…¶æ˜¯ä»Šæ—¥å¤´æ¡ï¼ï¼ï¼è°¢è°¢ğŸ™ğŸ™ğŸ™
>
> csdnï¼š[é›·å›­çš„csdnåšå®¢](https://blog.csdn.net/leiyuan2580)
>
> ä¸ªäººåšå®¢ï¼š[é›·å›­çš„ä¸ªäººåšå®¢](https://imlcl.store)
>
> ç®€ä¹¦ï¼š[é›·å›­çš„ç®€ä¹¦](https://www.jianshu.com/u/016322e40e1f)
>
> ä»Šæ—¥å¤´æ¡ï¼š[æ¥è‡ªåº•å±‚ç¨‹åºå‘˜çš„ä»°æœ›](https://www.toutiao.com/c/user/6132192948/#mid=1616456407686158)

## é»‘ç®±é•œåƒç¼ºç‚¹å¤ªå¤šï¼Ÿä½¿ç”¨Dockerfileé•œåƒåˆ¶ä½œæ‰ç®—æ­£ç»

### å¼€ç¯‡è¯´å‡ å¥

1. ä¸Šä¸€ç« èŠ‚æˆ‘ä»¬è¯´äº†é•œåƒçš„é»‘ç®±åˆ¶ä½œæ–¹å¼ã€‚
2. é»‘ç®±åˆ¶ä½œç¡®å®ç®€å•ï¼Œä½†æ˜¯æ­¥éª¤å´ä¹Ÿå¾ˆæ˜¯å¤æ‚ï¼Œä¸”åˆ¶ä½œå‡ºæ¥çš„é•œåƒä½“ç§¯æœ‰äº›å¤§ã€‚
3. è¿™ä¸€ç« èŠ‚æˆ‘ä»¬å°±æ¥è¯´è¯´ä½¿ç”¨Dockerfileåˆ¶ä½œæˆ‘ä»¬éœ€è¦çš„é•œåƒã€‚
4. é‚£ï½åœ¨è¿™é‡Œæ„Ÿè°¢å„ä½é•¿ä¹…ä»¥æ¥çš„å…³æ³¨åŠé˜…è¯»ï¼Œå¤§å®¶å¦‚æœæœ‰ä»»ä½•çš„ç–‘è™‘ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºå†™æ˜ï¼Œæˆ‘ä¸€å®šä¼šä¸€ä¸€å›å¤ï¼
5. å½“ç„¶ä¹Ÿå¯ä»¥ç§ä¿¡ä¸æˆ‘äº¤æµã€‚
6. ä»Šæ—¥åˆšåˆ›å»ºäº†åœˆå­ï¼Œå·²ç»ä¸ä¸“æ å…³è”ï¼Œéå¸¸æ¬¢è¿å¤§å®¶åŠ å…¥ï¼Œäº’ç›¸äº¤æµæ²Ÿé€šã€‚

### æ­£å¼å¼€å§‹

##### ä¸ºä»€ä¹ˆä½¿ç”¨Dockerfileåˆ¶ä½œé•œåƒ

1. é€šè¿‡ä¸Šä¸€ç¯‡çš„ä»‹ç»ä»¥åŠå¤§å®¶çš„è‡ªæˆ‘å®è·µï¼Œç›¸ä¿¡å¤§å®¶å¯ä»¥çœ‹å‡ºæ¥é»‘ç®±åˆ¶ä½œçš„é•œåƒç¼ºç‚¹ç¡®å®æ¯”è¾ƒæ˜æ˜¾ï¼Œæœ€ä¸»è¦çš„æ˜¯ä½“ç§¯æ¯”è¾ƒå¤§ï¼Œè€Œä¸”è¿è¡Œèµ·æ¥é€Ÿåº¦ä¹Ÿä¼šæœ‰æ‰€å—é™ã€‚
2. ä½¿ç”¨**Dockerfile**åˆ¶ä½œæˆ‘ä»¬çš„æ€è·¯ä¹Ÿä¼šæ›´åŠ æ¸…æ™°ï¼Œåšèµ·æ¥æ›´åŠ æœ‰æ¡ç†ã€‚
3. ä½¿ç”¨**Dockerfile**åˆ¶ä½œçš„é•œåƒä½“ç§¯æ›´å°ã€‚
4. åªè¦æœ‰ç›¸å…³æ–‡ä»¶ä»¥åŠ**Dockerfile**åœ¨ï¼Œä»»ä½•æœºå™¨éƒ½å¯ä»¥æ„å»ºé•œåƒã€‚

##### åˆ©ç”¨Dockerfileåˆ¶ä½œDocker Imageå‰çš„å‡†å¤‡å·¥ä½œ

1. ä¸å¯é¿å…è¦æœ‰ä¸€å°å®‰è£…äº†**Docker**çš„ç»ˆç«¯ï¼Œå¯ä»¥æ˜¯Mac OSã€Linuxã€Windowsï¼Œè¿™äº›ä¸ªç©æ„éƒ½å¯ä»¥ã€‚
2. å…¶æ¬¡è¦æœ‰ä¸€ä¸ªç¼–è¾‘å·¥å…·ï¼Œæˆ‘ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨**IDEA**æ‰“å¼€ç¼–è¾‘**Dockerfile**æ–‡ä»¶ï¼Œè¿™æ ·æ ¼å¼æ˜ç¡®åˆ©äºç¼–è¾‘ã€‚
3. å†ç„¶åå‘¢å°±æ˜¯æ•´ç†ä¸€ä¸‹å®‰è£…æ­¥éª¤ï¼Œå³ä¸ºéœ€è¦æ“ä½œçš„æ­¥éª¤æœ‰å“ªäº›ï¼Œæ¢³ç†æ¸…æ¥šé¿å…å› ä¸ºç¼–è¾‘é”™è¯¯å¯¼è‡´**Docker image**æ„å»ºå¤±è´¥ã€‚

##### Dockerfileå¸¸ç”¨å‘½ä»¤

1. FROMï¼šåŸºç¡€é•œåƒ
2. MAINTAINERï¼šå¤‡æ³¨ä¿¡æ¯
3. WORKDIRï¼šä½œä¸šç›®å½•
4. ADDï¼šæ·»åŠ æ–‡ä»¶è‡³é•œåƒ
5. COPYï¼šå¤åˆ¶æœ¬åœ°æ–‡ä»¶è‡³é•œåƒ
6. RUNï¼šæ‰§è¡Œshellå‘½ä»¤
7. ENVï¼šå®šä¹‰ç¯å¢ƒå˜é‡
8. EXPOSEï¼šå¼€æ”¾ç«¯å£ä¿¡æ¯
9. CMDï¼šå¯åŠ¨å‘½ä»¤æˆ–è¿è¡Œè„šæœ¬
10. è¿™é‡Œç®€å•è¯´ä¸€ä¸‹ENVï¼ˆç¯å¢ƒå˜é‡ï¼‰ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¼šå°†åŸæœ‰å˜é‡åç§°å…¨éƒ¨**å¤§å†™**å¹¶æ·»åŠ å‰ç¼€è¡¨æ˜ç¯å¢ƒå˜é‡çš„ä½œç”¨èŒƒå›´ï¼Œä¾‹å¦‚tomcatè¿è¡Œç«¯å£ä¸º**port=8080**ï¼Œé‚£ç¯å¢ƒå˜é‡ä¸­æˆ‘ä»¬ä¸€èˆ¬ä»¥**TOMCAT_PORT=8080**çš„å½¢å¼æ¥è¡¨ç¤ºã€‚

##### Dockerfileç¼–è¾‘

1. ä¸€èˆ¬æ¥è¯´ï¼ŒDockerfileçš„ç¼–è¾‘æˆ‘ä»¬åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ã€‚

2. ç¬¬ä¸€æ­¥å¼•ç”¨åŸºç¡€ã€‚

3. ç¬¬äºŒæ­¥å°†æ‰€éœ€ç”¨åˆ°çš„å¤–éƒ¨æ–‡ä»¶COPYæˆ–è€…ADDè‡³é•œåƒå†…éƒ¨ï¼Œä¸¤è€…ç•¥æœ‰äº›åŒºåˆ«ã€‚COPYå¯ä»¥ä»å®¿ä¸»æœºå¤åˆ¶æ–‡ä»¶è‡³é•œåƒä¸­ã€‚ADDå¯ä»¥ç›´æ¥ä½¿ç”¨é“¾æ¥ä¸‹è½½æ–‡ä»¶è‡³é•œåƒä¸­ã€‚

4. ç¬¬ä¸‰æ­¥ç¼–è¾‘æ“ä½œæ­¥éª¤ã€‚

5. ç¬¬å››æ­¥æ·»åŠ å¯åŠ¨å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä¸€èˆ¬æ·»åŠ å¯åŠ¨è„šæœ¬å¹¶ç»´æŒå‰ç«¯è¿è¡Œï¼Œå¦åˆ™è„šæœ¬æ‰§è¡Œå®Œå›è‡ªåŠ¨åœæ­¢Dockerå®¹å™¨çš„è¿è¡Œã€‚

6. å½“ç„¶å¹¶ä¸åªæœ‰è¿™äº›ï¼Œå¦‚æœæˆ‘ä»¬é•œåƒä¸­æœ‰ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œåˆ™æˆ‘ä»¬éœ€è¦åœ¨Dockerfileä¸­ç»™å‡ºç¯å¢ƒå˜é‡çš„åˆå§‹å€¼ï¼Œé¿å…å¯åŠ¨é•œåƒæ—¶æ²¡æœ‰åˆ¶å®šç¯å¢ƒå˜é‡å¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚

7. è¿˜æœ‰å¦‚æœéœ€è¦å¯¹å¤–å¼€æ”¾ç«¯å£æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è§„å®šå®¹å™¨çš„å¼€æ”¾ç«¯å£ä»¥ä¾¿ç”¨äºå®¿ä¸»æœºç«¯å£æ˜ å°„ã€‚

8. åŒ…å«**ffmpeg**è½¬ç å·¥å…·ä»¥åŠ**tomcat**çš„Dockeré•œåƒç¤ºä¾‹**Dockerfile**å¦‚ä¸‹ï¼š

   ```dockerfile
   FROM hub.c.163.com/public/centos:7.2-tools
   MAINTAINER Leiyuan
   COPY ffmpeg.tar.gz /usr/local/src/
   COPY startup.sh /root/
   COPY server.xml /root/
   RUN curl http://mirrors.aliyun.com/repo/Centos-7.repo | grep -v 'mirrors.aliyuncs.com' > /etc/yum.repos.d/CentOS-Base.repo \
       &&curl http://mirrors.aliyun.com/repo/epel-7.repo  | grep -v 'mirrors.aliyuncs.com' > /etc/yum.repos.d/epel-7.repo \
       &&yum clean all \
       &&yum makecache \
       &&yum -y update \
       &&yum -y install zlib zlib-devel pcre pcre-devel gcc gcc-c++ openssl openssl-devel libevent libevent-devel perl \
       &&cd /usr/local/src \
       &&tar -zxvf ffmpeg.tar.gz \
       &&rm -rf ffmpeg.tar.gz \
       &&yum -y install java-1.8.0-openjdk* \
       &&yum -y install gcc automake autoconf libtool make \
       &&sh ffmpeg/install_ffmpeg.sh \
       &&rm -rf ffmpeg \
       &&yum -y install wget \
       &&cd /root/ \
       &&wget http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-9/v9.0.21/bin/apache-tomcat-9.0.21.tar.gz \
       &&tar -zxvf apache-tomcat-9.0.21.tar.gz \
       &&rm -rf /root/apache-tomcat-9.0.21.tar.gz \
       &&mv apache-tomcat-9.0.21 tomcat \
       &&\cp /root/server.xml /root/tomcat/conf
   ENV TOMCAT_SERVER_PORT=8080 MQTT_SERVER_IP=127.0.0.1 MQTT_SERVER_PORT=1883 REDIS_SERVER_PORT=6379 REDIS_SERVER_IP=127.0.0.1 REDIS_SERVER_PASSWORD=admin MK_MYSQL_IP=127.0.0.1 MK_MYSQL_PORT=3306 MK_MYSQL_USER=root MK_MYSQL_PASS=root MK_ZOO_IP=127.0.0.1 MK_ZOO_PORT=2181 MK_FDFS_TRACKER_IP=127.0.0.1 MK_FDFS_TRACKER_PORT=22122 MK_FDFS_DOWN_IP=127.0.0.1 MK_FDFS_DOWN_PORT=8888
   CMD ["bash", "/root/startup.sh"]
   ```

##### å…³äºDocker imageçš„å…¶ä»–é—®é¢˜

1. åœ¨é•œåƒå¯åŠ¨åï¼Œä¸€å®šè¦ç»´æŒè¿è¡ŒçŠ¶æ€ï¼Œå¦åˆ™åœ¨æ‰§è¡Œå®Œå¯åŠ¨å‘½ä»¤åå®¹å™¨ä¼šè‡ªåŠ¨åœæ­¢ã€‚
2. æ‰€ä»¥æˆ‘åœ¨ç¼–å†™tomcaté•œåƒçš„å¯åŠ¨è„šæœ¬æ—¶ï¼Œä¼šåŠ å…¥`tail -f catalina.out`å‘½ä»¤ä»¥ä¿æŒå®¹å™¨çš„è¿è¡ŒçŠ¶æ€ã€‚

### æœ€åè¯´å‡ å¥

1. è¿™ä¸€ç« èŠ‚ä¸­æˆ‘ä»¬è¯´äº†**dockerfile**çš„åˆ¶ä½œæ–¹å¼ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå°è¯•åšä¸€äº›ç®€å•çš„é•œåƒï¼Œä¸é»‘ç®±åˆ¶ä½œæ–¹å¼è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹çœ‹ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚
2. å¦‚æœå¤§å®¶æœ‰ä»€ä¹ˆæƒ³æ³•æƒ³ä¸æˆ‘æ²Ÿé€šï¼Œå¯ä»¥é€šè¿‡è¯„è®ºæˆ–è€…ç§ä¿¡ï¼Œæˆ‘ä¼šä¸€ä¸€å›å¤ã€‚
3. æ–°å¼€é€šçš„åœˆå­å¸Œæœ›å¤§å®¶å¯ä»¥è¸Šè·ƒçš„å‚åŠ å¹¶å‘è¡¨è‡ªå·±çš„åŠ¨æ€å“¦ï¼ï¼ï¼
4. ä¸‹ä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šä»‹ç»ç¯å¢ƒå˜é‡çš„å…·ä½“ä½¿ç”¨æ–¹å¼ä»¥æ­¤å®ç°åŠ¨æ€é…ç½®ã€‚
5. è°¢è°¢å¤§å®¶çš„æŒç»­å…³æ³¨å’Œæ”¯æŒï¼ï¼ï¼
---
layout:     post
title:      å…è´¹å›¾åºŠä¸ç¨³å®šï¼æ”¶è´¹å›¾åºŠåˆä¸èˆå¾—ï¼Œæ•™ä½ 2åˆ†é’ŸMinioå¿«é€Ÿæ„å»ºå›¾åºŠ
subtitle:   å…è´¹å›¾åºŠä¸ç¨³å®šï¼æ”¶è´¹å›¾åºŠåˆä¸èˆå¾—ï¼Œæ•™ä½ 2åˆ†é’ŸMinioå¿«é€Ÿæ„å»ºå›¾åºŠ
date:       2020-09-04
author:     LY
header-img: img/post-bg-debug.png
catalog: true
tags:
    - K8S
    - å›¾åºŠ




---

> æ¬¢è¿å¤§å®¶å…³æ³¨æˆ‘çš„ä»¥ä¸‹ä¸»é¡µï¼Œå°¤å…¶æ˜¯ä»Šæ—¥å¤´æ¡ï¼ï¼ï¼è°¢è°¢ğŸ™ğŸ™ğŸ™
>
> csdnï¼š[é›·å›­çš„csdnåšå®¢](https://blog.csdn.net/leiyuan2580)
>
> ä¸ªäººåšå®¢ï¼š[é›·å›­çš„ä¸ªäººåšå®¢](https://imlcl.store)
>
> ç®€ä¹¦ï¼š[é›·å›­çš„ç®€ä¹¦](https://www.jianshu.com/u/016322e40e1f)
>
> ä»Šæ—¥å¤´æ¡ï¼š[æ¥è‡ªåº•å±‚ç¨‹åºå‘˜çš„ä»°æœ›](https://www.toutiao.com/c/user/6132192948/#mid=1616456407686158)

## å…è´¹å›¾åºŠä¸ç¨³å®šï¼æ”¶è´¹å›¾åºŠåˆä¸èˆå¾—ï¼Œæ•™ä½ 2åˆ†é’ŸMinioå¿«é€Ÿæ„å»ºå›¾åºŠ

#### å¼€å¤´è¯´å‡ å¥

1. å°ç¼–å†™åšå®¢æ–­æ–­ç»­ç»­ä¹Ÿæœ‰å¥½å‡ å¹´äº†ï¼Œä¹‹å‰ä¸€ç›´éƒ½æ˜¯ä½¿ç”¨iPicçš„å…è´¹å›¾åºŠã€‚
2. ä½†æ˜¯åæ¥å‘ç°äº†ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œè¿™ä¸ªå›¾åºŠæ—¶é—´é•¿äº†å›¾ç‰‡ä¼šå¤±æ•ˆå•Šï¼ï¼ï¼
3. ç®€ç›´æ˜¯â€œä¸§å°½å¤©è‰¯â€ï¼Œå¯¼è‡´æˆ‘ä¹‹å‰çš„åšå®¢å›¾ç‰‡å…¨éƒ½è®¿é—®ä¸äº†äº†ï¼Œå…‰çœ‹æ–‡å­—ç»å¯¹æ˜¯ä¸€è„¸æ‡µï¼
4. æœ€è¿‘å‘ç°äº†å¼€æºçš„å¯¹è±¡å­˜å‚¨**Minio**ï¼Œæ‰€ä»¥ç—›å®šæ€ç—›å†³å¿ƒè¦æä¸€ä¸ªè‡ªå·±çš„å›¾åºŠã€‚

#### è¯¦è¯»è¯¥æ–‡çš„èµ„æºéœ€æ±‚

1. æˆ‘ä»¬è¯´äº†è¦è‡ªå·±æä¸€ä¸ªå›¾åºŠäº†ï¼Œé‚£æˆ‘ä»¬å°±è‡³å°‘éœ€è¦æœ‰ä¸€å°æœåŠ¡å™¨æ¥è¿è¡Œæˆ‘ä»¬çš„**Minio**ã€‚
2. ä½†æ˜¯ï½æ—¢ç„¶æˆ‘ä»¬å‰å‡ æ–‡ä¸­éƒ½è¯´äº†**Kubernetes**ï¼Œé‚£æˆ‘ä»¬ä»Šå¤©å°±æ¥ä½¿ç”¨**K8S**æ¥æ„å»ºæˆ‘ä»¬çš„**Minio**åº”ç”¨ã€‚
3. æ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€å¥—**K8s**çš„ç¯å¢ƒäº†ã€‚
4. ä¸Šè¿°éƒ½å‡†å¤‡å¥½ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰ä¸ª**å…¬ç½‘IP**æ¥ä¸ºæˆ‘ä»¬æä¾›ç©¿é€æœåŠ¡ï¼Œä½¿æˆ‘ä»¬çš„å›¾ç‰‡å¯ä»¥åœ¨å¤–ç½‘è®¿é—®ã€‚
5. æœ€åå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„**Markdown**å·¥å…·**Typora**ï¼Œè¿™ä¸ªå·¥å…·ç”¨èµ·æ¥ç®€ç›´å¾—å¿ƒåº”æ‰‹ï¼Œä¸»è¦æ˜¯æ”¯æŒè‡ªå®šä¹‰å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼Œéå¸¸é€‚åˆæˆ‘ä»¬è‡ªè¡Œæ„å»ºå›¾åºŠã€‚
6. è¿˜æ²¡æœ‰å­¦ä¹ è¿‡K8Sã€å†…ç½‘ç©¿é€çš„å°ä¼™ä¼´ä»¬ï¼Œå¯ä»¥è·³è½¬å°ç¼–ä¸»é¡µæŸ¥çœ‹é¡¶ç½®å“¦ï¼Œç§K8så³å¯è·å–ç›¸å…³ä¸‹è½½åœ°å€ã€‚

#### å¦‚ä½•ä½¿ç”¨Kubernetesè¿è¡ŒMinioï¼Ÿ

1. é¦–å…ˆæˆ‘ä»¬å…ˆå»**Minio**å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ä¸€ä¸‹K8Sçš„å¯åŠ¨æ–¹å¼ã€‚

   ![æˆªå±2020-09-04 ä¸Šåˆ11.22.32](http://push.imlcl.store:9000/blog/202009/e0b038eeee5d11ea9c9facde48001122.png)

2. çœ‹åˆ°è¿™ä¸ªé¡µé¢å•¦ï¼Œæˆ‘ä»¬åªè¦è¾“å…¥ç›¸å…³çš„ä¿¡æ¯ï¼Œä»–å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªyamlæ–‡ä»¶ä¾›æˆ‘ä»¬åˆ›å»ºå®¹å™¨ã€‚

   ```yaml
   apiVersion: v1
   kind: PersistentVolumeClaim
   metadata:
     # This name uniquely identifies the PVC. Will be used in deployment below.
     name: minio-pv-claim
     labels:
       app: minio-storage-claim
   spec:
     # Read more about access modes here: https://kubernetes.io/docs/user-guide/persistent-volumes/#access-modes
     accessModes:
       - ReadWriteOnce
     resources:
       # This is the request for storage. Should be available in the cluster.
       requests:
         storage: 200Gi
     # Uncomment and add storageClass specific to your requirements below. Read more https://kubernetes.io/docs/concepts/storage/persistent-volumes/#class-1
     #storageClassName:
   ---
   apiVersion: extensions/v1
   kind: Deployment
   metadata:
     # This name uniquely identifies the Deployment
     name: minio-deployment
   spec:
     strategy:
       type: Recreate
     template:
       metadata:
         labels:
           # Label is used as selector in the service.
           app: minio
       spec:
         # Refer to the PVC created earlier
         volumes:
         - name: storage
           persistentVolumeClaim:
             # Name of the PVC created earlier
             claimName: minio-pv-claim
         containers:
         - name: minio
           # Pulls the default MinIO image from Docker Hub
           image: minio/minio
           args:
           - server
           - /storage
           env:
           # MinIO access key and secret key
           - name: MINIO_ACCESS_KEY
             value: "leiyuan"
           - name: MINIO_SECRET_KEY
             value: "Leiyuan123."
           ports:
           - containerPort: 9000
           # Mount the volume into the pod
           volumeMounts:
           - name: storage # must match the volume name, above
             mountPath: "/storage"
   ---
   apiVersion: v1
   kind: Service
   metadata:
     name: minio-service
   spec:
     type: LoadBalancer
     ports:
       - port: 9000
         targetPort: 9000
         protocol: TCP
     selector:
       app: minio
   ```

3. ä»–è¿™é‡Œçš„**Service**ç±»å‹ä¸º**LoadBalancer**ï¼Œå¦‚æœæœ‰å¿…è¦æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªèº«çš„éœ€æ±‚æ›´æ”¹ç±»å‹**NodePort**ã€‚

   ```yaml
   apiVersion: v1
   kind: Service
   metadata:
     name: minio-service
   spec:
     type: NodePort
     ports:
       - port: 9000
     selector:
       app: minio
   ```

4. ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶åˆ›å»º**Minio**åº”ç”¨`$ kubectl create -f minio-deployment.yaml`æˆ–è€…ç›´æ¥ä½¿ç”¨**Dashboard**åˆ›å»ºåº”ç”¨ã€‚

   ![æˆªå±2020-09-04 ä¸Šåˆ11.33.58](http://push.imlcl.store:9000/blog/202009/7bb38340ee5f11eaa53eacde48001122.png)

5. æˆ‘ä»¬åœ¨serviceä¸­å¹¶æ²¡æœ‰æŒ‡å®šNodePortç«¯å£ï¼Œéœ€è¦åˆ›å»ºåæŸ¥çœ‹ä¸€ä¸‹å¯¹å¤–çš„æ˜ å°„ç«¯å£

   ![æˆªå±2020-09-04 ä¸Šåˆ11.36.04](http://push.imlcl.store:9000/blog/202009/d2b75d42ee5f11eaa97dacde48001122.png)

6. æ¥ä¸‹æ¥å°±æ˜¯è®¿é—®æˆ‘ä»¬çš„**Minio**äº†,**ip:port**å³å¯è®¿é—®

   ![æˆªå±2020-09-04 ä¸Šåˆ11.38.04](http://push.imlcl.store:9000/blog/202009/0ccd78d8ee6011ea85a5acde48001122.png)

7. è¿™é‡Œè¾“å…¥æˆ‘ä»¬è®¾ç½®çš„è´¦å·å¯†ç å³å¯æ­£å¸¸ç™»é™†ã€‚è‡³æ­¤æˆ‘ä»¬çš„Minioç®—æ˜¯æ­å»ºå®Œæ¯•ï¼Œæ€ä¹ˆæ ·æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ

#### å¦‚ä½•å°†Minioç©¿é€è‡³å¤–ç½‘å¯è®¿é—®ï¼Ÿ

è¿™é‡Œæˆ‘å°±ä¸åšè¯¦ç»†çš„ä»‹ç»å•¦ï¼Œå¤§å®¶å¯ä»¥æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼Œç›¸ä¿¡ä½ å¯ä»¥å¾ˆå¿«æå®šç©¿é€çš„é—®é¢˜ã€‚

#### å¦‚ä½•åœ¨Typoraä¸­å®ç°Minioçš„æ— ç¼ä¸Šä¼ ï¼Ÿ

1. è¯¥è½¯ä»¶æœ¬æ˜¯ä¸æ”¯æŒMinioå›¾åºŠçš„ï¼Œä½†æ˜¯ä»–æœ‰ä¸ªå¾ˆå‰å®³çš„åŠŸèƒ½ã€‚ä½ å¯ä»¥è‡ªå®šä¹‰å‘½ä»¤æ¥å®ç°å›¾ç‰‡ä¸Šä¼ çš„åŠŸèƒ½ã€‚

2. é‚£æˆ‘ä»¬å°±ä½¿ç”¨pythonè„šæœ¬æ¥å®ç°å›¾ç‰‡çš„ä¸Šä¼ åŠŸèƒ½ï¼Œç„¶ååœ¨Typoraä¸­ä½¿ç”¨pythonè„šæœ¬è¿›è¡Œæ— ç¼å›¾ç‰‡ä¸Šä¼ ã€‚

3. é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…**Python**ï¼Œå®‰è£…è¿‡ç¨‹ä¸å†èµ˜è¿°ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ä½¿ç”¨python3ã€‚

4. å…¶æ¬¡æˆ‘ä»¬éœ€è¦å®‰è£…Minioç›¸å…³çš„pythonåº“ä»¥æ”¯æŒæˆ‘ä»¬çš„è„šæœ¬è¿è¡Œã€‚

   ```shell
   # è·å–å®˜æ–¹ä»£ç 
   $ git clone https://github.com/minio/minio-py
   # è¿›è¡Œå®‰è£…
   $ cd minio-py
   $ sudo python3 setup.py install
   ```

5. åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæç¤ºç¼ºå°‘æŸäº›åº“ï¼Œé‚£å°±éœ€è¦å°ä¼™ä¼´ä»¬çœ‹ä¸€ä¸‹ç¼ºä»€ä¹ˆå®‰è£…ä»€ä¹ˆå•¦

6. ç¼–å†™ä¸Šä¼ è„šæœ¬

   ```python
   import os
   import time
   import uuid
   import sys
   import requests
   from minio import Minio
   from minio.error import ResponseError
   import warnings
   warnings.filterwarnings('ignore')
   images = sys.argv[1:]
   # ä¸Šä¼ çš„åœ°å€ä»¥åŠç”¨æˆ·åå¯†ç 
   minioClient = Minio("{ip:port}",
                       access_key='leiyuan', secret_key='Leiyuan123.', secure=False)
   result = "Upload Success:\n"
   date = time.strftime("%Y%m", time.localtime())
   def download(image_url):
       local_path = os.getcwd() + "/temp"
       r = requests.get(image_url, verify=False)
       with open(local_path, "wb") as code:
           code.write(r.content)
       return local_path
   for image in images:
       if os.path.isfile(image):
           file_type = os.path.splitext(image)[-1]
           new_file_name = str(uuid.uuid1()).replace('-', '') + file_type
       elif image.startswith("https://") or image.startswith("http://"):
           if image.endswith(".png") or image.endswith(".jpg") or image.endswith(".jpeg") or image.endswith(".gif"):
               url = image.split("/")
               if len(url) > 1:
                   image = download(image)
                   new_file_name = url[-1]
               else:
                   result = result + "error:parsing image error!"
                   continue
           else:
               result = result + "error:parsing image error!"
               continue
       else:
           result = result + "error:parsing image error!"
           continue
       try:
         # blogä¸ºæ¡¶åç§°ï¼Œå¯è‡ªè¡Œä¿®æ”¹
           minioClient.fput_object(bucket_name='blog', object_name=date + "/" + new_file_name, file_path=image)
           if image.endswith("temp"):
               os.remove(image)
               # å¤–ç½‘çš„IPä»¥åŠç«¯å£å·
           result = result +"http(s)://ip:port" + "/blog/" + date + "/" + new_file_name + "\n"
       except ResponseError as err:
           result = result + "error:" + err.message + "\n"
   print(result)
   ```

7. è¿™é‡Œå¤§å®¶è¦æ³¨æ„æ›¿æ¢æ³¨é‡Šå¤„çš„å‚æ•°ä¿¡æ¯

8. è¿™æ ·å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸‹è¯•è¯•

   ![æˆªå±2020-09-04 ä¸‹åˆ12.00.50](http://push.imlcl.store:9000/blog/202009/47512446ee6311eab5aeacde48001122.png)

9. å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸Šä¼ æˆåŠŸäº†å¹¶ä¸”ä»–ç»™æˆ‘ä»¬è¿”å›äº†ä¸€ä¸ªä¸‹è½½åœ°å€ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦æŠŠè„šæœ¬é›†æˆåˆ°Typoraè½¯ä»¶è®©å®ƒå®ç°è‡ªåŠ¨ä¸Šä¼ å³å¯

#### é…ç½®Typoraä¸Šä¼ è®¾ç½®

1. æ‰“å¼€åå¥½è®¾ç½®ä¸­çš„å›¾åƒè®¾ç½®

2. é…ç½®å¦‚ä¸‹

   ![image-20200904120437259](http://push.imlcl.store:9000/blog/202009/bff57e74ee6311ea9530acde48001122.png)

3. åœ¨è‡ªå®šä¹‰å‘½ä»¤ä¸­å¡«å…¥æˆ‘ä»¬çš„ä¸Šä¼ å‘½ä»¤ï¼š

   ```shell
   $ /Library/Frameworks/Python.framework/Versions/3.6/bin/python3 /Users/leiyuan/Documents/ä»Šæ—¥å¤´æ¡æ–‡ç« /upload_minio.py
   ```

4. è¿™é‡Œæ³¨æ„ä¸€ä¸‹æˆ‘ä»¬éƒ½æ˜¯ç”¨ç»å¯¹è·¯å¾„é¿å…ä»–æ‰¾ä¸åˆ°å‘½ä»¤æˆ–è€…è„šæœ¬ã€‚

5. è¿™æ ·è®¾ç½®ä¹‹åå°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬æ‰“å¼€Typoraç„¶åå°†å›¾ç‰‡æ‹–æ‹½è‡³ç¼–è¾‘æ¡†å³å¯å®ç°è‡ªåŠ¨ä¸Šä¼ ã€‚

#### ç»“æŸäº†ï½ï½

1. è‡³æ­¤æˆ‘ä»¬çš„å›¾åºŠç®—æ˜¯æå®šäº†ï¼Œåªè¦ä½ çš„minioæœåŠ¡ä¸åï¼Œæ•°æ®ä¸ä¸¢ï¼Œé‚£å°±æ²¡é—®é¢˜äº†ï¼Œä½ çš„å›¾ç‰‡ä¼šä¸€ç›´éƒ½åœ¨ã€‚
2. å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒå…è´¹å›¾åºŠå®³æˆ‘æ–‡ç« é˜…è¯»ä¸é€šäº†ï½ï½ï½

#### æœ€åçš„æœ€å

1. æ²¡æœ‰äº†ï¼å†è§å§ï¼